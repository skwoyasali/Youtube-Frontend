import{G as j,d as oe,u as me,r as o,j as e,L as T,e as Q}from"./index-BBDrbdVF.js";import{a as x}from"./index-NIGUFBhG.js";import{b as xe}from"./index-DCNRoj0A.js";import{p as ue}from"./index-7ekGWKMM.js";function he(l){return j({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 0 0-26.5-5.4H273v428h.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM112 132v364c0 17.7 14.3 32 32 32h65V100h-65c-17.7 0-32 14.3-32 32z"},child:[]}]})(l)}function pe(l){return j({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 0 0-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 0 0 471 99.9c-52 0-98 35-111.8 85.1l-85.9 311h-.3v428h472.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM112 528v364c0 17.7 14.3 32 32 32h65V496h-65c-17.7 0-32 14.3-32 32z"},child:[]}]})(l)}function ge(l){return j({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 0 0-26.5-5.4H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h129.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM184 456V172h81v284h-81zm627.2 160.4H496.8l9.6 198.4c.6 11.9-4.7 23.1-14.6 30.5-6.1 4.5-13.6 6.8-21.1 6.7a44.28 44.28 0 0 1-42.2-32.3L329 459.2V172h415.4a56.85 56.85 0 0 1 33.6 51.8c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0 1 19.6 43c0 9.7-2.3 18.9-6.9 27.3l-13.9 25.4 21.9 19a56.76 56.76 0 0 1 19.6 43c0 9.7-2.3 18.9-6.9 27.3l-14 25.5 21.9 19a56.76 56.76 0 0 1 19.6 43c0 19.1-11 37.5-28.8 48.4z"},child:[]}]})(l)}function be(l){return j({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M885.9 533.7c16.8-22.2 26.1-49.4 26.1-77.7 0-44.9-25.1-87.4-65.5-111.1a67.67 67.67 0 0 0-34.3-9.3H572.4l6-122.9c1.4-29.7-9.1-57.9-29.5-79.4A106.62 106.62 0 0 0 471 99.9c-52 0-98 35-111.8 85.1l-85.9 311H144c-17.7 0-32 14.3-32 32v364c0 17.7 14.3 32 32 32h601.3c9.2 0 18.2-1.8 26.5-5.4 47.6-20.3 78.3-66.8 78.3-118.4 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7 0-12.6-1.8-25-5.4-37 16.8-22.2 26.1-49.4 26.1-77.7-.2-12.6-2-25.1-5.6-37.1zM184 852V568h81v284h-81zm636.4-353l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 16.5-7.2 32.2-19.6 43l-21.9 19 13.9 25.4a56.2 56.2 0 0 1 6.9 27.3c0 22.4-13.2 42.6-33.6 51.8H329V564.8l99.5-360.5a44.1 44.1 0 0 1 42.2-32.3c7.6 0 15.1 2.2 21.1 6.7 9.9 7.4 15.2 18.6 14.6 30.5l-9.6 198.4h314.4C829 418.5 840 436.9 840 456c0 16.5-7.2 32.1-19.6 43z"},child:[]}]})(l)}function ve(){var H,P,O,G,K,q,J;const{videoId:l}=oe(),{user:a}=me(),[r,W]=o.useState(null),[X,$]=o.useState(!0),[z,L]=o.useState(null),[N,u]=o.useState(!1),[C,h]=o.useState(!1),[Y,p]=o.useState(0),[Z,g]=o.useState(0),[A,B]=o.useState(!1),[f,E]=o.useState(""),[I,k]=o.useState([]),[M,D]=o.useState(null),[R,S]=o.useState(null),[y,w]=o.useState(""),[ee,te]=o.useState([]);o.useEffect(()=>{$(!0),L(null),Promise.all([x.get("https://youtube-backend-0gem.onrender.com/api/videos"),x.get(`https://youtube-backend-0gem.onrender.com/api/video/${l}`),x.get(`https://youtube-backend-0gem.onrender.com/api/comment/${l}`)]).then(([t,m,d])=>{var i,c;te(t.data),W(m.data),p(m.data.likes||0),g(m.data.dislikes||0);const s=(d.data||[]).slice().sort((n,b)=>{const v=new Date(n.timestamp||n.createdAt).getTime();return new Date(b.timestamp||b.createdAt).getTime()-v});k(s.map(n=>{var b,v,_;return{_id:n._id,username:((b=n.user)==null?void 0:b.username)||"Unknown",avatar:((v=n.user)==null?void 0:v.avatar)||"https://placehold.co/40x40.png?text=?",text:n.text,timestamp:n.timestamp||n.createdAt,userId:(_=n.user)==null?void 0:_._id}})),a?(u((i=m.data.likedBy)==null?void 0:i.includes(a._id)),h((c=m.data.dislikedBy)==null?void 0:c.includes(a._id))):(u(!1),h(!1))}).catch(t=>{L("Failed to load video.")}).finally(()=>$(!1))},[l,a]);const ae=t=>`https://www.youtube.com/embed/${new URL(t).searchParams.get("v")}`,se=async()=>{if(a)try{if(N){const t=await x.patch(`https://youtube-backend-0gem.onrender.com/api/video/${l}/unlike`,{},{headers:{Authorization:`Bearer ${a.token}`}});u(!1),p(t.data.likes),g(t.data.dislikes)}else{const t=await x.patch(`https://youtube-backend-0gem.onrender.com/api/video/${l}/like`,{},{headers:{Authorization:`Bearer ${a.token}`}});u(!0),h(!1),p(t.data.likes),g(t.data.dislikes)}}catch{alert("Failed to update like")}},re=async()=>{if(a)try{if(C){const t=await x.patch(`https://youtube-backend-0gem.onrender.com/api/video/${l}/undislike`,{},{headers:{Authorization:`Bearer ${a.token}`}});h(!1),p(t.data.likes),g(t.data.dislikes)}else{const t=await x.patch(`https://youtube-backend-0gem.onrender.com/api/video/${l}/dislike`,{},{headers:{Authorization:`Bearer ${a.token}`}});h(!0),u(!1),p(t.data.likes),g(t.data.dislikes)}}catch{alert("Failed to update dislike")}},V=async()=>{if(!(!a||!f.trim()))try{await x.post("https://youtube-backend-0gem.onrender.com/api/comment",{text:f,videoId:l},{headers:{Authorization:`Bearer ${a.token}`}});const m=((await x.get(`https://youtube-backend-0gem.onrender.com/api/comment/${l}`)).data||[]).slice().sort((d,s)=>{const i=new Date(d.timestamp||d.createdAt).getTime();return new Date(s.timestamp||s.createdAt).getTime()-i});k(m.map(d=>{var s,i,c;return{_id:d._id,username:((s=d.user)==null?void 0:s.username)||"Unknown",avatar:((i=d.user)==null?void 0:i.avatar)||"https://placehold.co/40x40.png?text=?",text:d.text,timestamp:d.timestamp||d.createdAt,userId:(c=d.user)==null?void 0:c._id}})),E("")}catch{alert("Failed to add comment")}},le=async t=>{if(a&&window.confirm("Delete this comment?"))try{await x.delete(`https://youtube-backend-0gem.onrender.com/api/comment/${t}`,{headers:{Authorization:`Bearer ${a.token}`}});const d=((await x.get(`https://youtube-backend-0gem.onrender.com/api/comment/${l}`)).data||[]).slice().sort((s,i)=>{const c=new Date(s.timestamp||s.createdAt).getTime();return new Date(i.timestamp||i.createdAt).getTime()-c});k(d.map(s=>{var i,c,n;return{_id:s._id,username:((i=s.user)==null?void 0:i.username)||"Unknown",avatar:((c=s.user)==null?void 0:c.avatar)||"https://placehold.co/40x40.png?text=?",text:s.text,timestamp:s.timestamp||s.createdAt,userId:(n=s.user)==null?void 0:n._id}})),D(null)}catch{alert("Failed to delete comment")}},ie=t=>{S(t._id),w(t.text),D(null)},ne=async t=>{if(!(!a||!y.trim()))try{await x.patch(`https://youtube-backend-0gem.onrender.com/api/comment/${t}`,{text:y},{headers:{Authorization:`Bearer ${a.token}`}});const d=((await x.get(`https://youtube-backend-0gem.onrender.com/api/comment/${l}`)).data||[]).slice().sort((s,i)=>{const c=new Date(s.timestamp||s.createdAt).getTime();return new Date(i.timestamp||i.createdAt).getTime()-c});k(d.map(s=>{var i,c,n;return{_id:s._id,username:((i=s.user)==null?void 0:i.username)||"Unknown",avatar:((c=s.user)==null?void 0:c.avatar)||"https://placehold.co/40x40.png?text=?",text:s.text,timestamp:s.timestamp||s.createdAt,userId:(n=s.user)==null?void 0:n._id}})),S(null),w("")}catch{alert("Failed to edit comment")}},de=()=>{S(null),w("")},F=180,U=r&&r.description&&r.description.length>F,ce=r&&r.description?A?r.description:r.description.slice(0,F):"";return X?e.jsx("div",{style:{padding:32},children:"Loading..."}):z?e.jsx("div",{style:{padding:32,color:"red"},children:z}):r?e.jsxs("div",{className:"w-full px-4 pt-16 py-5 sm:pl-15 sm:ml-16 pb-20 flex flex-col lg:flex-row lg:items-start gap-6 max-w-screen-xl mx-auto",children:[e.jsxs("div",{className:"w-full lg:w-[70%]",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"relative z-0 w-full aspect-video mb-4 overflow-hidden rounded-xl bg-black",children:e.jsx("iframe",{src:ae(r.videoLink),className:"w-full h-full relative z-0",title:r.title,allow:"autoplay; encrypted-media",allowFullScreen:!0})}),e.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-black dark:text-white mb-3",children:r.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 border-b pb-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{to:`/channels/${(H=r==null?void 0:r.channel)==null?void 0:H._id}`,children:e.jsx("img",{src:(P=r.channel)==null?void 0:P.channelPic,alt:(O=r.channel)==null?void 0:O.channelName,className:"w-10 h-10 rounded-full object-cover"})}),e.jsxs(T,{to:`/channels/${(G=r==null?void 0:r.channel)==null?void 0:G._id}`,className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-black dark:text-white",children:(K=r.channel)==null?void 0:K.channelName}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[((J=(q=r.channel)==null?void 0:q.subscribers)==null?void 0:J.toLocaleString())||0," ","subscribers"]})]})]}),e.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white text-sm font-medium px-4 py-2 rounded-full transition",children:"Subscribe"})]}),a&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-4 sm:mt-2",children:[e.jsxs("button",{onClick:se,disabled:!a,title:a?"":"Login to like",className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition 
         ${N?"bg-blue-100 text-blue-600":"bg-gray-100 hover:bg-gray-200 text-gray-700"}
         disabled:opacity-50`,children:[N?e.jsx(pe,{className:"text-lg"}):e.jsx(be,{className:"text-lg"}),e.jsx("span",{children:Y})]}),e.jsxs("button",{onClick:re,disabled:!a,title:a?"":"Login to dislike",className:`flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition 
         ${C?"bg-red-100 text-red-600":"bg-gray-100 hover:bg-gray-200 text-gray-700"}
         disabled:opacity-50`,children:[C?e.jsx(he,{className:"text-lg"}):e.jsx(ge,{className:"text-lg"}),e.jsx("span",{children:Z})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-700 transition",children:[e.jsx(xe,{className:"text-lg"}),e.jsx("span",{children:"Share"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium bg-gray-100 hover:bg-gray-200 text-gray-700 transition",children:[e.jsx(ue,{className:"text-lg"}),e.jsx("span",{children:"Download"})]}),e.jsx("button",{className:"p-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-700 transition",children:e.jsx(Q,{className:"text-xl"})})]})]}),e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-gray-100 dark:bg-neutral-800 text-sm text-gray-800 dark:text-gray-200",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:[e.jsxs("span",{children:[(r.views||0).toLocaleString()," views"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:r.uploadDate?new Date(r.uploadDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):""})]}),e.jsxs("div",{className:"whitespace-pre-wrap break-words leading-relaxed",children:[ce,U&&!A&&e.jsx("span",{className:"text-blue-600 ml-1 cursor-pointer hover:underline",onClick:()=>B(!0),children:"...more"}),U&&A&&e.jsx("span",{className:"text-blue-600 ml-2 cursor-pointer hover:underline",onClick:()=>B(!1),children:"Show less"})]})]}),e.jsxs("div",{className:"mt-6 w-full max-w-5xl px-4 sm:px-6 lg:px-0",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-800 dark:text-white mb-4",children:[I.length," Comments"]}),e.jsxs("div",{className:"flex items-start gap-3 mb-6",children:[e.jsx("img",{src:(a==null?void 0:a.avatar)||"https://placehold.co/40.png?text=?",alt:(a==null?void 0:a.username)||"User",className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("input",{className:"w-full px-4 py-2 rounded-full bg-gray-100 dark:bg-neutral-800 text-sm focus:outline-none focus:ring focus:ring-blue-500",placeholder:a?"Add a comment...":"Login to comment",value:f,onChange:t=>E(t.target.value),onKeyDown:t=>t.key==="Enter"&&V(),disabled:!a}),e.jsx("div",{className:"z-0",children:e.jsx("button",{className:"mt-1 px-4 py-1.5 text-sm rounded-full bg-blue-600 text-white disabled:opacity-50",onClick:V,disabled:!a||!f.trim(),children:"Comment"})})]})]}),e.jsx("div",{className:"space-y-6",children:I.map(t=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("img",{src:t.avatar,alt:t.username,className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-800 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:t.username}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs",children:t.timestamp?new Date(t.timestamp).toLocaleDateString():""})]}),a&&t.userId===a._id&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"text-gray-500 hover:text-gray-700",onClick:()=>D(M===t._id?null:t._id),children:e.jsx(Q,{})}),M===t._id&&e.jsxs("div",{className:"absolute right-0 mt-2 w-28 bg-white dark:bg-neutral-700 border rounded shadow-md z-10 text-sm",children:[e.jsx("button",{className:"w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-neutral-600",onClick:()=>ie(t),children:"Edit"}),e.jsx("button",{className:"w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100 dark:hover:bg-neutral-600",onClick:()=>le(t._id),children:"Delete"})]})]})]}),e.jsx("div",{className:"mt-1 text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:R===t._id?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mt-2",children:[e.jsx("input",{className:"flex-1 px-3 py-1.5 rounded-md border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-800 text-sm focus:outline-none focus:ring-1 focus:ring-blue-500",value:y,onChange:m=>w(m.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-1.5 bg-blue-600 text-white text-sm rounded-md disabled:opacity-50",onClick:()=>ne(t._id),disabled:!y.trim(),children:"Save"}),e.jsx("button",{className:"px-4 py-1.5 bg-gray-200 dark:bg-neutral-600 text-gray-800 dark:text-white text-sm rounded-md",onClick:de,children:"Cancel"})]})]}):t.text})]})]},t._id))})]})]}),e.jsxs("div",{className:"w-full lg:w-[30%] px-4 lg:px-0 mt-6 lg:mt-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white mb-4",children:"Up next"}),e.jsx("div",{className:"space-y-4",children:ee.slice(0,10).map(t=>e.jsxs(T,{to:`/video/${t._id}`,className:"flex items-start gap-3 hover:bg-gray-100 dark:hover:bg-neutral-800 p-2 rounded-md transition",children:[e.jsx("img",{src:t.thumbnail,alt:t.title,className:"w-32 h-20 object-cover rounded-md bg-gray-200 dark:bg-neutral-700 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white leading-snug line-clamp-2",children:t.title})})]},t._id))})]})]}):null}export{ve as default};
